import{h as U,g as v,D,r as t,j as c,A as P,G as H,M as _,c as k,C as q,d as B,f as G,O as z,u as V,a as N,R as X}from"./index-BngEeYwx.js";const $=e=>e;function J(e,n=$){const r=v.useSyncExternalStore(e.subscribe,v.useCallback(()=>n(e.getState()),[e,n]),v.useCallback(()=>n(e.getInitialState()),[e,n]));return v.useDebugValue(r),r}const I=e=>{const n=U(e),r=o=>J(n,o);return Object.assign(r,n),r},K=(e=>e?I(e):I);let w=0;const Q=K(e=>(D.onStart=(n,r,o)=>{e({active:!0,item:n,loaded:r,total:o,progress:(r-w)/(o-w)*100})},D.onLoad=()=>{e({active:!1})},D.onError=n=>e(r=>({errors:[...r.errors,n]})),D.onProgress=(n,r,o)=>{r===o&&(w=o),e({active:!0,item:n,loaded:r,total:o,progress:(r-w)/(o-w)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),W=e=>`Loading ${e.toFixed(2)}%`;function Y({containerStyles:e,innerStyles:n,barStyles:r,dataStyles:o,dataInterpolation:u=W,initialState:f=s=>s}){const{active:s,progress:a}=Q(),d=t.useRef(0),E=t.useRef(0),l=t.useRef(null),[h,m]=t.useState(f(s));t.useEffect(()=>{let p;return s!==h&&(p=setTimeout(()=>m(s),300)),()=>clearTimeout(p)},[h,s]);const i=t.useCallback(()=>{l.current&&(d.current+=(a-d.current)/2,(d.current>.95*a||a===100)&&(d.current=a),l.current.innerText=u(d.current),d.current<a&&(E.current=requestAnimationFrame(i)))},[u,a]);return t.useEffect(()=>(i(),()=>cancelAnimationFrame(E.current)),[i]),h?t.createElement("div",{style:{...M.container,opacity:s?1:0,...e}},t.createElement("div",null,t.createElement("div",{style:{...M.inner,...n}},t.createElement("div",{style:{...M.bar,transform:`scaleX(${a/100})`,...r}}),t.createElement("span",{ref:l,style:{...M.data,...o}})))):null}const M={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};function Z({servoAngle:e,maxLift:n}){return c.jsx(P,{servoAngle:e,maxLift:n})}function ee({servoAngle:e,setServoAngle:n,speed:r,setSpeed:o,runHomingSequence:u,goToAngle:f,maxLift:s,homingState:a,setHomingState:d,setIsDragging:E,onInteraction:l}){const h=t.useRef(e);t.useEffect(()=>{h.current=e},[e]);const m=t.useMemo(()=>({runHoming:()=>{l(),u()},rotatePlus10:()=>{l(),f(h.current+10)},rotateMinus10:()=>{l(),f(h.current-10)},stop:()=>{l(),d("idle")}}),[u,f,d,l]),i=t.useRef({angle:e,lift:e/180*s*1e3,speed:r,status:a,homingDuration:180/r*1e3});return t.useEffect(()=>{i.current.angle=e,i.current.lift=e/180*s*1e3,i.current.speed=r,i.current.status=a,i.current.homingDuration=180/r*1e3},[e,r,s,a]),t.useEffect(()=>{const p=new H({title:"Actuator Controls"}),j=p.addFolder("Manual Control"),x=p.addFolder("Actions"),T=p.addFolder("Real-Time Data"),g=a!=="idle",y=S=>C=>{l(),E(!0),S(C)},A=()=>{l(),E(!1)},R=j.add(i.current,"angle",0,180,.1).name("Servo Angle (°)").listen();R.onChange(y(n)),R.onFinishChange(A);const b=j.add(i.current,"lift",0,s*1e3,.1).name("Lift (mm)").listen();b.onChange(y(S=>{const C=S/(s*1e3)*180;n(C)})),b.onFinishChange(A),R.domElement.style.pointerEvents=g?"none":"auto",R.domElement.style.opacity=g?"0.5":"1",b.domElement.style.pointerEvents=g?"none":"auto",b.domElement.style.opacity=g?"0.5":"1",j.add(i.current,"speed",30,300,10).name("Speed (deg/s)").onChange(S=>{l(),o(S)}),x.add(i.current,"homingDuration",0,6e3,1).name("Homing Duration (ms)").listen().disable(),x.add(m,"runHoming").name("Run Homing Sequence"),x.add(m,"rotatePlus10").name("Rotate +10°"),x.add(m,"rotateMinus10").name("Rotate -10°");const F=x.add(m,"stop").name("STOP");return F.domElement.style.backgroundColor="#C00",F.domElement.style.color="white",T.add(i.current,"status").name("Status").listen().disable(),()=>{p.destroy()}},[m,n,o,f,s,a,d,E,l]),null}function te({isIdle:e,controlsRef:n}){return V((r,o)=>{if(e&&n.current){const u=n.current,f=u.target,s=r.camera,a=.3*o;s.position.sub(f),s.position.applyAxisAngle(new N(0,1,0),a),s.position.add(f),u.update()}}),null}function ne(){const[e,n]=t.useState(90),[r,o]=t.useState(90),[u,f]=t.useState(180),[s,a]=t.useState("idle"),[d,E]=t.useState(!1),[l,h]=t.useState(!0),m=t.useRef(null),i=t.useRef(null),p=t.useCallback(()=>{h(!1),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>h(!0),1e4)},[]);t.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]);const j=t.useRef(e);t.useEffect(()=>{j.current=e},[e]);const x=t.useCallback(()=>{s==="idle"&&a("homing_down")},[s]),T=t.useCallback(g=>{const y=_.clamp(g,0,180);s==="idle"&&y!==r&&(o(y),a("moving"))},[s,r]);return t.useEffect(()=>{if(d||s==="idle")return;let g,y,A=null;const R=b=>{A||(A=b);const F=(b-A)/1e3;A=b;const S=j.current;if(s==="homing_down"){const C=S-u*F;n(Math.max(0,C))}else{const C=r-S;if(Math.abs(C)<u*F){n(r),a("idle");return}const L=Math.sign(C),O=S+L*u*F;n(O)}g=requestAnimationFrame(R)};if(s==="homing_down"){const b=180/u*1e3;y=setTimeout(()=>{cancelAnimationFrame(g),n(0),o(90),a("homing_up")},b)}return g=requestAnimationFrame(R),()=>{cancelAnimationFrame(g),y&&clearTimeout(y)}},[s,r,u,d]),c.jsxs(c.Fragment,{children:[c.jsx(ee,{servoAngle:e,setServoAngle:n,speed:u,setSpeed:f,runHomingSequence:x,goToAngle:T,maxLift:k,homingState:s,setHomingState:a,setIsDragging:E,onInteraction:p}),c.jsxs(q,{shadows:!0,camera:{position:[.05,.075,.25],fov:50},children:[c.jsxs(t.Suspense,{fallback:null,children:[c.jsx(B,{preset:"city"}),c.jsx("directionalLight",{position:[5,5,-2],intensity:1.5,castShadow:!0,"shadow-bias":-1e-4}),c.jsx("directionalLight",{position:[-5,5,2],intensity:.5}),c.jsx("ambientLight",{intensity:.7}),c.jsx(Z,{servoAngle:e,maxLift:k}),c.jsx(G,{infiniteGrid:!0,sectionColor:"#505050",sectionSize:.1,fadeDistance:2,fadeStrength:1.5})]}),c.jsx(z,{ref:i,onStart:p,makeDefault:!0,minDistance:.15,maxDistance:.5,target:[0,.05,0]}),c.jsx(te,{isIdle:l,controlsRef:i})]}),c.jsx(Y,{})]})}X.createRoot(document.getElementById("root")).render(c.jsx(v.StrictMode,{children:c.jsx(ne,{})}));

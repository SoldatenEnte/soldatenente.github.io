import{i as P,h as v,D as M,r as t,j as c,A as H,G as _,M as q,c as I,C as B,d as G,f as z,O as V,u as N,a as X,R as $}from"./index-BjywAXCu.js";const J=e=>e;function K(e,n=J){const r=v.useSyncExternalStore(e.subscribe,v.useCallback(()=>n(e.getState()),[e,n]),v.useCallback(()=>n(e.getInitialState()),[e,n]));return v.useDebugValue(r),r}const L=e=>{const n=P(e),r=i=>K(n,i);return Object.assign(r,n),r},Q=(e=>e?L(e):L);let F=0;const W=Q(e=>(M.onStart=(n,r,i)=>{e({active:!0,item:n,loaded:r,total:i,progress:(r-F)/(i-F)*100})},M.onLoad=()=>{e({active:!1})},M.onError=n=>e(r=>({errors:[...r.errors,n]})),M.onProgress=(n,r,i)=>{r===i&&(F=i),e({active:!0,item:n,loaded:r,total:i,progress:(r-F)/(i-F)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Y=e=>`Loading ${e.toFixed(2)}%`;function Z({containerStyles:e,innerStyles:n,barStyles:r,dataStyles:i,dataInterpolation:u=Y,initialState:m=s=>s}){const{active:s,progress:a}=W(),d=t.useRef(0),E=t.useRef(0),l=t.useRef(null),[h,f]=t.useState(m(s));t.useEffect(()=>{let g;return s!==h&&(g=setTimeout(()=>f(s),300)),()=>clearTimeout(g)},[h,s]);const o=t.useCallback(()=>{l.current&&(d.current+=(a-d.current)/2,(d.current>.95*a||a===100)&&(d.current=a),l.current.innerText=u(d.current),d.current<a&&(E.current=requestAnimationFrame(o)))},[u,a]);return t.useEffect(()=>(o(),()=>cancelAnimationFrame(E.current)),[o]),h?t.createElement("div",{style:{...T.container,opacity:s?1:0,...e}},t.createElement("div",null,t.createElement("div",{style:{...T.inner,...n}},t.createElement("div",{style:{...T.bar,transform:`scaleX(${a/100})`,...r}}),t.createElement("span",{ref:l,style:{...T.data,...i}})))):null}const T={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};function ee({servoAngle:e,maxLift:n}){return c.jsx(H,{servoAngle:e,maxLift:n})}function te({servoAngle:e,setServoAngle:n,speed:r,setSpeed:i,runHomingSequence:u,goToAngle:m,maxLift:s,homingState:a,setHomingState:d,setIsDragging:E,onInteraction:l}){const h=t.useRef(e);t.useEffect(()=>{h.current=e},[e]);const f=t.useMemo(()=>({runHoming:()=>{l(),u()},rotatePlus10:()=>{l(),m(h.current+10)},rotateMinus10:()=>{l(),m(h.current-10)},stop:()=>{l(),d("idle")}}),[u,m,d,l]),o=t.useRef({angle:e,lift:e/180*s*1e3,speed:r,status:a,homingDuration:180/r*1e3});return t.useEffect(()=>{o.current.angle=e,o.current.lift=e/180*s*1e3,o.current.speed=r,o.current.status=a,o.current.homingDuration=180/r*1e3},[e,r,s,a]),t.useEffect(()=>{const g=new _({title:"Actuator Controls"}),j=g.addFolder("Manual Control"),C=g.addFolder("Actions"),k=g.addFolder("Real-Time Data"),w=a!=="idle",p=S=>R=>{l(),E(!0),S(R)},b=()=>{l(),E(!1)},y=j.add(o.current,"angle",0,180,.1).name("Servo Angle (°)").listen();y.onChange(p(n)),y.onFinishChange(b);const A=j.add(o.current,"lift",0,s*1e3,.1).name("Lift (mm)").listen();A.onChange(p(S=>{const R=S/(s*1e3)*180;n(R)})),A.onFinishChange(b),y.domElement.style.pointerEvents=w?"none":"auto",y.domElement.style.opacity=w?"0.5":"1",A.domElement.style.pointerEvents=w?"none":"auto",A.domElement.style.opacity=w?"0.5":"1",j.add(o.current,"speed",30,300,10).name("Speed (deg/s)").onChange(S=>{l(),i(S)}),C.add(o.current,"homingDuration",0,6e3,1).name("Homing Duration (ms)").listen().disable(),C.add(f,"runHoming").name("Run Homing Sequence"),C.add(f,"rotatePlus10").name("Rotate +10°"),C.add(f,"rotateMinus10").name("Rotate -10°");const x=C.add(f,"stop").name("STOP");return x.domElement.style.backgroundColor="#C00",x.domElement.style.color="white",k.add(o.current,"status").name("Status").listen().disable(),()=>{g.destroy()}},[f,n,i,m,s,a,d,E,l]),null}function ne({isIdle:e,controlsRef:n}){return N((r,i)=>{if(e&&n.current){const u=n.current,m=u.target,s=r.camera,a=.3*i;s.position.sub(m),s.position.applyAxisAngle(new X(0,1,0),a),s.position.add(m),u.update()}}),null}function re(){const[e,n]=t.useState(90),[r,i]=t.useState(90),[u,m]=t.useState(180),[s,a]=t.useState("idle"),[d,E]=t.useState(!1),[l]=t.useState("ontouchstart"in window),[h,f]=t.useState(!0),o=t.useRef(null),g=t.useRef(null),j=t.useCallback(()=>{f(!1),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>f(!0),1e4)},[]);t.useEffect(()=>()=>{o.current&&clearTimeout(o.current)},[]);const C=t.useRef(e);t.useEffect(()=>{C.current=e},[e]);const k=t.useCallback(()=>{s==="idle"&&a("homing_down")},[s]),w=t.useCallback(p=>{const b=q.clamp(p,0,180);s==="idle"&&b!==r&&(i(b),a("moving"))},[s,r]);return t.useEffect(()=>{if(d||s==="idle")return;let p,b,y=null;const A=x=>{y||(y=x);const S=(x-y)/1e3;y=x;const R=C.current;if(s==="homing_down"){const D=R-u*S;n(Math.max(0,D))}else{const D=r-R;if(Math.abs(D)<u*S){n(r),a("idle");return}const O=Math.sign(D),U=R+O*u*S;n(U)}p=requestAnimationFrame(A)};if(s==="homing_down"){const x=180/u*1e3;b=setTimeout(()=>{cancelAnimationFrame(p),n(0),i(90),a("homing_up")},x)}return p=requestAnimationFrame(A),()=>{cancelAnimationFrame(p),b&&clearTimeout(b)}},[s,r,u,d]),c.jsxs(c.Fragment,{children:[c.jsx(te,{servoAngle:e,setServoAngle:n,speed:u,setSpeed:m,runHomingSequence:k,goToAngle:w,maxLift:I,homingState:s,setHomingState:a,setIsDragging:E,onInteraction:j}),c.jsxs(B,{shadows:!0,camera:{position:[.05,.075,.25],fov:50},children:[c.jsxs(t.Suspense,{fallback:null,children:[c.jsx(G,{preset:"city"}),c.jsx("directionalLight",{position:[5,5,-2],intensity:1.5,castShadow:!0,"shadow-bias":-1e-4}),c.jsx("directionalLight",{position:[-5,5,2],intensity:.5}),c.jsx("ambientLight",{intensity:.7}),c.jsx(ee,{servoAngle:e,maxLift:I}),c.jsx(z,{infiniteGrid:!0,sectionColor:"#505050",sectionSize:.1,fadeDistance:2,fadeStrength:1.5})]}),c.jsx(V,{ref:g,onStart:j,makeDefault:!0,minDistance:.15,maxDistance:.5,target:[0,.05,0]}),!l&&c.jsx(ne,{isIdle:h,controlsRef:g})]}),c.jsx(Z,{})]})}$.createRoot(document.getElementById("root")).render(c.jsx(v.StrictMode,{children:c.jsx(re,{})}));
